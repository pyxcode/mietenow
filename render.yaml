# üöÄ Configuration Render pour MieteNow
# Ce fichier d√©crit tous les services n√©cessaires pour d√©ployer l'application

services:
  # üåê Application Web Next.js
  - type: web
    name: mietenow-web
    env: node
    region: frankfurt
    plan: starter
    buildCommand: NODE_ENV=production npm install && NODE_ENV=production npm run build
    startCommand: NODE_ENV=production npm start
    healthCheckPath: /
    # Forcer le mode serveur (pas d'export statique)
    runtime: node
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_APP_URL
        fromService:
          type: web
          name: mietenow-web
          property: host

  # üîÑ Cron Job - Scraping quotidien
  - type: cron
    name: mietenow-scraper
    env: node
    region: frankfurt
    plan: starter
    schedule: "0 6,12,18 * * *"  # 3 fois par jour : 6h, 12h, 18h
    buildCommand: npm install
    startCommand: node scripts/cron-scraping-standalone.js
    envVars:
      - key: NODE_ENV
        value: production

  # üßπ Cron Job - Nettoyage des anciennes annonces
  - type: cron
    name: mietenow-cleanup
    env: node
    region: frankfurt
    plan: starter
    schedule: "0 2 * * *"  # Tous les jours √† 2h du matin
    buildCommand: npm install
    startCommand: node scripts/cron-cleanup-standalone.js
    envVars:
      - key: NODE_ENV
        value: production

  # üìß Cron Job - Envoi des alertes
  - type: cron
    name: mietenow-alerts
    env: node
    region: frankfurt
    plan: starter
    schedule: "0 8,20 * * *"  # 2 fois par jour : 8h et 20h
    buildCommand: npm install
    startCommand: node scripts/cron-send-alerts.js
    envVars:
      - key: NODE_ENV
        value: production

  # üí∞ Cron Job - V√©rification des plans
  - type: cron
    name: mietenow-plans
    env: node
    region: frankfurt
    plan: starter
    schedule: "0 1 * * *"  # Tous les jours √† 1h du matin
    buildCommand: npm install
    startCommand: node scripts/cron-check-plans.js
    envVars:
      - key: NODE_ENV
        value: production

# üîß Variables d'environnement partag√©es
# Ces variables doivent √™tre configur√©es dans le dashboard Render
envVars:
  - key: NODE_ENV
    value: production
  - key: MONGODB_URI
    description: "URI de connexion MongoDB Atlas"
  - key: JWT_SECRET
    description: "Cl√© secr√®te pour JWT"
  - key: NEXTAUTH_SECRET
    description: "Cl√© secr√®te pour NextAuth"
  - key: NEXTAUTH_URL
    description: "URL de l'application"
  - key: APIKEYSENDGRID
    description: "Cl√© API SendGrid pour les emails"
  - key: SENDGRID_FROM_EMAIL
    description: "Email d'exp√©diteur SendGrid"
  - key: NEXT_PUBLIC_STRIPE_API
    description: "Cl√© publique Stripe"
  - key: STRIPE_SECRET_KEY
    description: "Cl√© secr√®te Stripe"
  - key: STRIPE_WEBHOOK_SECRET
    description: "Secret webhook Stripe"
  - key: CLOUDINARY_URL
    description: "URL Cloudinary pour les images"
  - key: BRIGHT_DATA_USERNAME
    description: "Nom d'utilisateur Bright Data"
  - key: BRIGHT_DATA_PASSWORD
    description: "Mot de passe Bright Data"
  - key: BRIGHT_DATA_ENDPOINT
    description: "Endpoint Bright Data"

